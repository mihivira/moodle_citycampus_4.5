define("local_hoteles_city_dashboard/course_detail",["local_hoteles_city_dashboard/graphics_courses","local_hoteles_city_dashboard/utils"],(function(graphicsCourses,utils){var CourseDetail={datatable:null,reportCourses:"",config:{},intervals:0,columns:[],id_div_grafica:"curso_graficas",init:function(config){this.config=config,this.reportCourses=-1!=config.courseid?config.courseid:"",console.log("CourseDetail init with config:",this.config),this.config.ajax_code=this.parseAjaxCode(this.config.ajax_code||[]),this.initEvents(),this.initializeChoices(),this.initDataTable()},initializeChoices:function(){$(".multiselect-setting").each((function(index,element){new Choices("#"+element.id,{removeItemButton:!0,searchEnabled:!0,placeholderValue:"Presione aquí para agregar un filtro",searchPlaceholderValue:"Buscar filtro",placeholder:!0})}))},initEvents:function(){console.log("Inicializando eventos para CourseDetail");var self=this;$(document).on("click","#search_btn",(function(){self.reportCourses=$("#report_courses").val(),self.datatable&&self.datatable.ajax.reload()})),$(document).on("click","#quitar_cursos",(function(){self.quitarCursos()})),$(document).on("click","#todos_cursos, #descargar_cursos",(function(){self.todosCursos()}))},initDataTable:function(){console.log("Inicializando DataTable para CourseDetail");var self=this;0!==$("#empTable").length?($.fn.DataTable.isDataTable("#empTable")&&(console.log("Destruyendo DataTable existente"),$("#empTable").DataTable().destroy()),this.datatable=$("#empTable").DataTable({processing:!0,serverSide:!0,serverMethod:"post",initComplete:function(){console.log("DataTable inicializado"),$(".dataTables_filter input").off("keyup.DT input.DT"),$(".dataTables_filter input").on("keyup",(function(e){13==(e.keyCode||e.which)&&self.datatable.search(this.value).draw()}))},ajax:{url:self.config.wwwroot+"/local/hoteles_city_dashboard/services.php",data:function(d){d.request_type="course_users_pagination",d.reportCourses=self.reportCourses||"",console.log("Enviando datos AJAX:",d),self.mostrarGraficaDeCursos(),self.reportCourses&&self.reportCourses>0&&self.selectCurso(self.reportCourses)},dataSrc:function(json){if(console.log("Respuesta AJAX recibida:",json),json.error)return console.error("Error del servidor:",json.error),[];var data=json.data||json.aaData||[];return console.log("Datos procesados:",data),data}},lengthMenu:[[-1],["Todos los registros"]],dom:"Bfrtip",pageLength:-1,buttons:[{extend:"excelHtml5",text:'<span class="fa fa-file-excel-o"></span> Exportar a excel',exportOptions:{modifier:{search:"applied",order:"applied"},columns:self.parseColumns(self.config.ajax_printed_rows)}},{extend:"csvHtml5",text:'<span class="fa fa-file-o"></span> Exportar a CSV',exportOptions:{modifier:{search:"applied",order:"applied"},columns:self.parseColumns(self.config.ajax_printed_rows)}},"pageLength"],columns:self.parseAjaxCode(self.config.ajax_code),language:{url:"datatables/Spanish.json",emptyTable:"No se encontró información",loadingRecords:"Cargando...",processing:"<div class='spinner'></div>",search:"Búsqueda:",paginate:{first:"Primera",last:"Última",next:"Siguiente",previous:"Anterior"},buttons:{pageLength:{_:"Mostrando %d filas","-1":"Mostrando todas las filas"}}},columnDefs:[{targets:self.parseColumns(self.config.ajax_link_fields),orderable:!1}]}),$.fn.dataTable.ext.errMode="throw",console.log("DataTable inicializado correctamente")):console.log("No se encontró la tabla #empTable")},parseColumns:function(columnString){return columnString?columnString.split(",").map(Number):[]},parseAjaxCode:function(ajaxCode){const columns=ajaxCode;return columns.forEach(((column,index)=>{"link_edit_user"===column.data?column.render=function(data,type,row){return'<a target="_self" class="btn btn-primary" href="administrar_usuarios.php?id='.concat(data,'">Editar usuario</a>')}:"name"===column.data?column.render=function(data,type,row){const parts=data.split("||");return'<a class="_blank" href="administrar_usuarios.php?id='.concat(parts[1],'">').concat(parts[0],"</a>")}:"link_suspend_user"===column.data?column.render=function(data,type,row){const arrSusp=data.split("||"),clase="1"===arrSusp[1]?"btn btn-danger":"btn btn-success",texto="1"===arrSusp[1]?"Activar":"Suspender",id=arrSusp[0];return'<button class="confirm-action '.concat(clase,'" data-id="').concat(id,'" data-texto="').concat(texto,'">').concat(texto,"</button>")}:"link_libro_calificaciones"===column.data&&(column.render=function(data,type,row){const parts=data.split("||");return'<a target="_blank" class="btn btn-primary" href="'.concat(this.config.wwwroot,"/grade/report/user/index.php?id=").concat(parts[1],"&userid=").concat(parts[0],'">Libro de calificaciones</a>')}.bind(this))})),console.log("Parsed columns:",columns),columns},mostrarGraficaDeCursos:function(){var self=this,courseId=this.reportCourses;console.log("Mostrando curso(s): ",courseId),Array.isArray(courseId)&&(courseId=courseId.toString());var peticion={request_type:"course_completion",courseid:courseId||""};console.log("Enviando petición para mostrar gráfica de cursos:",peticion),$.ajax({type:"POST",url:this.config.wwwroot+"/local/hoteles_city_dashboard/services.php",data:peticion,dataType:"json"}).done((function(data){if(data&&data.data){var informacion=data.data;self.cleanDiv(),console.log("Información recibida:",informacion),(informacion=utils.getPercentages(informacion)).title=informacion.title||"Gráfica de Cursos";var course=new graphicsCourses(self.id_div_grafica,informacion.title,informacion.chart,informacion,12,informacion.id);informacion.enrolled_users>0?(course.printCardCourseInfo(),setTimeout((course_instance=course,course_info=informacion,function(){utils.renderCourseChart(course_instance,course_info)}),100)):course.printCardSinInfo(),self.showPage()}var course_instance,course_info})).fail((function(xhr,status,error){console.log("Error en mostrarGraficaDeCursos:",error),self.showPage()}))},cleanDiv:function(){var graficaDiv=document.getElementById(this.id_div_grafica);graficaDiv&&(graficaDiv.innerHTML="")},showPage:function(){},quitarCursos:function(){$("#report_courses").val(null),this.reportCourses="",this.datatable&&this.datatable.ajax.reload()},todosCursos:function(){var allCourses=[];$("#report_courses option").map((function(){allCourses.push(this.value)})).get(),$("#report_courses").val(allCourses),this.reportCourses=allCourses.join(","),this.datatable&&this.datatable.ajax.reload()},selectCurso:function(courseid){$("#report_courses").val([courseid])},descargarReporte:function(){var courseId=this.reportCourses||this.config.default_courses,url=this.config.wwwroot+"/local/hoteles_city_dashboard/descargar_reporte.php?course="+courseId;alert("Este proceso demora varios minutos, por lo tanto no abandones la sesión, ni vuelvas a dar clic en el botón hasta que se descargue el documento."),window.location.href=url,$("#exampleModal").modal("show")},iResize:function(frame_id){if(!(this.intervals>60)){this.intervals++;var element=document.getElementById(frame_id);if(null!=element&&null!=element.contentWindow&&null!=element.contentWindow.document&&null!=element.contentWindow.document.body&&null!=element.contentWindow.document.body.offsetHeight){element.contentWindow.document.body.offsetHeight;document.getElementById(frame_id).style.height="1500px"}}}};return CourseDetail}));

//# sourceMappingURL=course_detail.min.js.map