{"version":3,"file":"dashboard.min.js","sources":["../src/dashboard.js"],"sourcesContent":["define([\n    'jquery',\n    'core/ajax',\n    'core/chartjs',\n    'core/templates',\n    'core/str',\n    'core/notification'\n], function($, Ajax, Chart, Templates, Str, Notification) {\n\n    // Variables globales\n    var isCourseLoading = false;\n    var suma_inscritos = 0;\n    var suma_no_aprobados = 0;\n    var suma_aprobados = 0;\n    var arr_total_inscritos = [];\n    var arr_total_no_aprobados = [];\n    var arr_total_aprobados = [];\n    var total_inscritos = 0;\n    var total_no_aprobados = 0;\n    var total_aprobados = 0;\n    var porcentaje_aprobados = 0;\n    var porcentaje_noaprobados = 0;\n\n    /**\n     * Muestra el overlay de carga\n     */\n    function mostrarCargando() {\n        var overlay = document.getElementById('overlay');\n        if (overlay) {\n            overlay.style.display = 'flex';\n        }\n    }\n\n    /**\n     * Oculta el overlay de carga\n     */\n    function ocultarCargando() {\n        var overlay = document.getElementById('overlay');\n        if (overlay) {\n            overlay.style.display = 'none';\n        }\n    }\n\n    /**\n     * Obtiene información por curso\n     */\n    function regresaInfoByCurso() {\n        mostrarCargando();\n        \n        var requests = Ajax.call([{\n            methodname: 'local_hoteles_city_dashboard_data',\n            args: {\n               \n            }\n        }]);\n\n        requests[0].done(function(data) {\n            ocultarCargando();\n            isCourseLoading = false;\n\n            data = JSON.parse(data);\n\n            console.log(\"data JSON.parse\");\n            console.log(data);\n\n            var respuesta = data.data;\n\n            console.log(respuesta);\n            \n            var respuesta = data.data;\n            \n            for (var i = 0; i < respuesta.length; i++) {\n                var resp = respuesta[i];\n                var curso = new GraphicsDashboard('contenedor_graficas', resp.name, resp.chart, resp, 6);\n                \n                if (resp.elements.length > 0) {\n                    curso.printCardAdvance();\n                } else {\n                    curso.printCardSinInfo();\n                }\n\n                switch (resp.chart) {\n                    case 'bar-agrupadas':\n                    case 'line':\n                    case 'horizontalBar':\n                    case 'burbuja':\n                        curso.comparative_graph();\n                        break;\n                    case 'pie':\n                    case 'bar':\n                        curso.individual_graph();\n                        break;\n                }\n            }\n            printInfoCards();\n\n        }).fail(function(error) {\n            isCourseLoading = false;\n            Notification.exception(error);\n        });\n    }\n\n    /**\n     * Procesa datos para gráficas\n     */\n    function graph_data(respuesta) {\n        var data_labels = [];\n        var arr_datasets_aprobados_percentage = [];\n        var arr_datasets_no_aprobados_percentage = [];\n        var arr_datasets_inscritos = [];\n        var dataset = [];\n        var suma_inscritos = 0;\n        var suma_no_aprobados = 0;\n        var suma_aprobados = 0;\n\n        for (var j = 0; j < respuesta.elements.length; j++) {\n            data_labels.push(respuesta.elements[j].name);\n            \n            var approved_users = parseFloat(respuesta.elements[j].percentage);\n            var not_approved = 100 - approved_users;\n            var percentage_not_approved = not_approved.toFixed(2);\n            \n            arr_datasets_aprobados_percentage.push(approved_users);\n            arr_datasets_no_aprobados_percentage.push(percentage_not_approved);\n            arr_datasets_inscritos.push('100');\n            \n            suma_inscritos += parseInt(respuesta.elements[j].enrolled_users);\n            suma_no_aprobados += parseInt(respuesta.elements[j].not_approved_users);\n            suma_aprobados += parseInt(respuesta.elements[j].approved_users);\n        }\n\n        arr_total_inscritos.push(suma_inscritos);\n        arr_total_no_aprobados.push(suma_no_aprobados);\n        arr_total_aprobados.push(suma_aprobados);\n\n        var total_inscritos = arr_total_inscritos.reduce((a, b) => a + b, 0);\n        var total_no_aprobados = arr_total_no_aprobados.reduce((a, b) => a + b, 0);\n        var total_aprobados = arr_total_aprobados.reduce((a, b) => a + b, 0);\n        \n        var porcentaje_aprobados = ((total_aprobados * 100) / total_inscritos) || 0;\n        var porcentaje_noaprobados = ((total_no_aprobados * 100) / total_inscritos) || 0;\n\n        var datasets_aprobados, datasets_no_aprobados;\n\n        switch (respuesta.chart) {\n            case 'bar-agrupadas':\n                datasets_aprobados = { \n                    label: 'Completado', \n                    backgroundColor: '#1cc88a', \n                    stack: 'Stack 0', \n                    data: arr_datasets_aprobados_percentage \n                };\n                datasets_no_aprobados = { \n                    label: 'No Completado', \n                    backgroundColor: '#e74a3b', \n                    stack: 'Stack 0', \n                    data: arr_datasets_no_aprobados_percentage \n                };\n                dataset.push(datasets_aprobados);\n                dataset.push(datasets_no_aprobados);\n                break;\n                \n            case 'line':\n                datasets_aprobados = { \n                    label: 'Completado', \n                    borderColor: \"#1cc88a\", \n                    backgroundColor: 'transparent', \n                    data: arr_datasets_aprobados_percentage \n                };\n                datasets_no_aprobados = { \n                    label: 'No Completado', \n                    borderColor: \"#e74a3b\", \n                    backgroundColor: 'transparent', \n                    data: arr_datasets_no_aprobados_percentage \n                };\n                dataset.push(datasets_aprobados);\n                dataset.push(datasets_no_aprobados);\n                break;\n                \n            case 'horizontalBar':\n                datasets_aprobados = { \n                    label: 'Completado', \n                    backgroundColor: '#1cc88a', \n                    stack: 'Stack 0', \n                    data: arr_datasets_aprobados_percentage \n                };\n                datasets_no_aprobados = { \n                    label: 'No Completado', \n                    backgroundColor: '#e74a3b', \n                    stack: 'Stack 0', \n                    data: arr_datasets_no_aprobados_percentage \n                };\n                dataset.push(datasets_aprobados);\n                dataset.push(datasets_no_aprobados);\n                break;\n        }\n\n        return { labels: data_labels, datasets: dataset };\n    }\n\n    /**\n     * Imprime información en las cards\n     */\n    function printInfoCards() {\n        var requests = Ajax.call([{\n            methodname: 'local_hoteles_city_dashboard_cards',\n            args: {\n                \n            }\n        }]);\n\n        requests[0].done(function(data) {\n            data = JSON.parse(data);\n            var info_cards = data.data;\n            var approved_users = parseFloat(info_cards.approved_users).toFixed(2);\n            var not_approved_users = parseFloat(info_cards.not_approved_users).toFixed(2);\n\n            $('#card_cantidad_usarios').html(info_cards.num_users);\n            $('#card_no_aprobados').html(not_approved_users + '%');\n            $('#progress_noaprobados').css(\"width\", not_approved_users + \"%\");\n            $('#card_aprobados').html(approved_users + \"%\");\n            $('#progress_aprobados').css(\"width\", approved_users + \"%\");\n            $('#card_numero_hoteles').html(info_cards.num_institutions);\n\n        }).fail(function(error) {\n            Notification.exception(error);\n        });\n    }\n\n    /**\n     * Clase para manejar gráficas del dashboard\n     */\n    class GraphicsDashboard {\n        constructor(div_print_card, title, type_graph, data_graph, col_size_graph, enlace) {\n            this.div_print_card = div_print_card;\n            this.title = title;\n            this.div_graph = div_print_card + Date.now();\n            this.type_graph = type_graph;\n            this.data_graph = data_graph;\n            this.col_size_graph = col_size_graph;\n            this.enlace = enlace;\n        }\n\n        printCardAdvance() {\n            $(\"#\" + this.div_print_card).append(`\n                <div class=\"col-sm-${this.col_size_graph}\">\n                    <div class=\"card shadow mb-4\">\n                        <div class=\"card-header py-3 d-flex flex-row align-items-center justify-content-between\">\n                            <h6 class=\"m-0 font-weight-bold text-primary\"><a href=\"#\">${this.title}</a></h6>\n                        </div>\n                        <div class=\"card-body\">\n                            <div class=\"\">\n                                <canvas id=\"${this.div_graph}\"></canvas>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `);\n        }\n\n        printCardSinInfo() {\n            $(\"#\" + this.div_print_card).append(`\n                <div class=\"col-sm-${this.col_size_graph} col-md-6 col-lg-4\">\n                    <div class=\"card shadow mb-4\">\n                        <div class=\"card-header py-3 d-flex flex-row align-items-center justify-content-between\">\n                            <h6 class=\"m-0 font-weight-bold text-primary\"><a href=\"#\">${this.title}</a></h6>\n                        </div>\n                        <div class=\"card-body\">\n                            <div class=\"\">\n                                <canvas id=\"${this.div_graph}\" style=\"display: none\"></canvas>\n                                <h3 class=\"txt_sin_usuarios\">No hay usuarios inscritos</h3>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `);\n        }\n\n        comparative_graph() {\n            switch (this.type_graph) {\n                case 'bar-agrupadas':\n                case 'line':\n                    var data_agrupadas = graph_data(this.data_graph);\n                    var ctx = document.getElementById(this.div_graph);\n                    \n                    new Chart(ctx, {\n                        type: this.type_graph === 'bar-agrupadas' ? 'bar' : this.type_graph,\n                        data: data_agrupadas,\n                        options: {}\n                    });\n                    break;\n\n                case 'horizontalBar':\n                    var data_agrupadas = graph_data(this.data_graph);\n                    var ctx = document.getElementById(this.div_graph);\n                    ctx.height = (data_agrupadas.labels.length * 20);\n                    \n                    // Corrección: usar 'bar' con indexAxis: 'y'\n                    new Chart(ctx, {\n                        type: 'bar',\n                        data: data_agrupadas,\n                        options: {\n                            indexAxis: 'y', // Esto hace que sea horizontal\n                        }\n                    });\n                    break;\n\n                case 'burbuja':\n                    if (this.data_graph.enrolled_users > 0) {\n                        var ctx = document.getElementById(this.div_graph);\n                        new Chart(ctx, {\n                            type: 'bubble',\n                            data: {\n                                labels: \"Africa\",\n                                datasets: [{\n                                    label: [\"Hotel 1\"],\n                                    backgroundColor: \"rgba(255,221,50,0.2)\",\n                                    borderColor: \"rgba(255,221,50,1)\",\n                                    data: [{ x: 212, y: 207, r: 5 }]\n                                }]\n                            },\n                            options: {\n                                title: {\n                                    display: true,\n                                    text: 'Predicted world population (millions) in 2050'\n                                },\n                                scales: {\n                                    yAxes: [{\n                                        scaleLabel: {\n                                            display: true,\n                                            labelString: \"Happiness\"\n                                        }\n                                    }],\n                                    xAxes: [{\n                                        scaleLabel: {\n                                            display: true,\n                                            labelString: \"GDP (PPP)\"\n                                        }\n                                    }]\n                                }\n                            }\n                        });\n                    } else {\n                        var ctx = document.getElementById(this.div_graph);\n                        if (ctx) ctx.innerHTML = \"No existen usuarios inscritos\";\n                    }\n                    break;\n            }\n        }\n\n        individual_graph() {\n            switch (this.type_graph) {\n                case 'pie':\n                    var d_graph = [];\n                    var approved_percentage = parseFloat(this.data_graph.percentage);\n                    var not_approved_percentage = 100 - approved_percentage;\n                    \n                    d_graph.push(approved_percentage);\n                    d_graph.push(not_approved_percentage);\n\n                    var ctx = document.getElementById(this.div_graph);\n                    new Chart(ctx, {\n                        type: 'pie',\n                        data: {\n                            labels: [\"Completado\", \"No Completado\"],\n                            datasets: [{\n                                backgroundColor: [\"#1cc88a\", \"#e74a3b\"],\n                                data: d_graph\n                            }]\n                        },\n                        options: {}\n                    });\n                    break;\n\n                case 'bar':\n                    var d_graph = [];\n                    var approved_percentage = parseFloat(this.data_graph.percentage);\n                    var not_approved_percentage = 100 - approved_percentage;\n                    \n                    d_graph.push(approved_percentage);\n                    d_graph.push(not_approved_percentage);\n                    d_graph.push('0');\n                    d_graph.push('100');\n\n                    var ctx = document.getElementById(this.div_graph);\n                    new Chart(ctx, {\n                        type: 'bar',\n                        data: {\n                            labels: [\"Completado\", \"No Completado\"],\n                            datasets: [{\n                                backgroundColor: [\"#1cc88a\", \"#e74a3b\"],\n                                data: d_graph\n                            }]\n                        },\n                        options: {\n                            legend: { display: false }\n                        }\n                    });\n                    break;\n            }\n        }\n    }\n\n    /**\n     * Inicializa el módulo\n     */\n    function init() {\n        $(document).ready(function() {\n            \n            regresaInfoByCurso();\n        });\n    }\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Chart","Templates","Str","Notification","arr_total_inscritos","arr_total_no_aprobados","arr_total_aprobados","regresaInfoByCurso","overlay","document","getElementById","style","display","call","methodname","args","done","data","ocultarCargando","JSON","parse","console","log","respuesta","i","length","resp","curso","GraphicsDashboard","name","chart","elements","printCardAdvance","printCardSinInfo","comparative_graph","individual_graph","info_cards","approved_users","parseFloat","toFixed","not_approved_users","html","num_users","css","num_institutions","fail","error","exception","graph_data","data_labels","arr_datasets_aprobados_percentage","arr_datasets_no_aprobados_percentage","arr_datasets_inscritos","dataset","suma_inscritos","suma_no_aprobados","suma_aprobados","j","push","percentage","percentage_not_approved","parseInt","enrolled_users","datasets_aprobados","datasets_no_aprobados","total_inscritos","reduce","a","b","label","backgroundColor","stack","borderColor","labels","datasets","constructor","div_print_card","title","type_graph","data_graph","col_size_graph","enlace","div_graph","Date","now","this","append","data_agrupadas","ctx","type","options","height","indexAxis","x","y","r","text","scales","yAxes","scaleLabel","labelString","xAxes","innerHTML","d_graph","not_approved_percentage","approved_percentage","legend","init","ready"],"mappings":"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"}