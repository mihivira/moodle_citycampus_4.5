/**
 * Módulo AMD para el dashboard de reportes por UO (sin jQuery).
 *
 * @module local_hoteles_city_dashboard/reportes_uo_main
 * @copyright  2025
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_hoteles_city_dashboard/reportes_uo_main",["core/log","local_hoteles_city_dashboard/xlsx","local_hoteles_city_dashboard/jspdf","local_hoteles_city_dashboard/html2canvas","local_hoteles_city_dashboard/autotable","local_hoteles_city_dashboard/config","local_hoteles_city_dashboard/reportes_uo"],(function(Log,XLSX,jsPDF,html2canvas,autoTable,unused,ReportesUo){let tab="avance",customHistory=[],uniqid=null;function loadGraphics(uniqid,regions,type){window.console.log("Cargando gráficos:",{regions:regions,type:type}),function(){const overlay=document.getElementById("overlay");overlay&&(overlay.style.display="flex")}(),ReportesUo.init(uniqid,regions,type),customHistory.push({regions:regions,type:type}),function(){const tbody=document.getElementById("tbody"),chartCont=document.getElementById("chart-cont");tbody&&(tbody.innerHTML="");chartCont&&(chartCont.innerHTML="")}()}function exportExcel(tableId,titleReport){const table=document.getElementById(tableId);if(!table)return;const wb=XLSX.utils.table_to_book(table,{sheet:"Sheet1"}),date=new Date,filename="".concat(titleReport,"_").concat(date.getFullYear(),"-").concat(date.getMonth()+1,"-").concat(date.getDate(),".xlsx");XLSX.writeFile(wb,filename)}function exportPdf(titleReport){const table=document.getElementById("tdata");if(!table)return;const headers=Array.from(table.querySelectorAll("thead th, thead td")).map((th=>th.textContent.trim())),rows=Array.from(table.querySelectorAll("tbody tr")).map((tr=>Array.from(tr.querySelectorAll("td")).map((td=>td.textContent.trim()))));var pdf=new window.jspdf.jsPDF({orientation:"landscape"});let marginLeft=15;pdf.autoTable({head:[headers],body:rows,startY:20,theme:"grid",margin:{top:20,bottom:10},styles:{cellPadding:3,fontSize:10,valign:"middle",halign:"center"},columnStyles:{0:{fontStyle:"bold"}},didDrawPage:data=>{marginLeft=data.settings.margin.left,pdf.setFontSize(12),pdf.text(titleReport,marginLeft,10)}}),pdf.addPage(),pdf.setFontSize(12),pdf.text(titleReport,marginLeft,10);const chartContainer=document.getElementById("chart-cont");if(!chartContainer)return console.warn("No se encontró #chart-cont"),void pdf.save("".concat(titleReport,".pdf"));const canvas=chartContainer.querySelector("canvas");return canvas?0===canvas.width||0===canvas.height?(console.warn("El canvas tiene tamaño 0x0. Esperando..."),void setTimeout((()=>{exportPdf(titleReport)}),500)):void window.html2canvas(canvas,{scale:4,useCORS:!0,logging:!1,backgroundColor:"#ffffff"}).then((function(imgData){const imgHeight=250*(canvas.height/canvas.width);pdf.addImage(imgData,"PNG",15,15,250,imgHeight);const date=new Date,filename="".concat(titleReport,"_").concat(date.getFullYear(),"-").concat(date.getMonth()+1,"-").concat(date.getDate(),".pdf");pdf.save(filename)})).catch((err=>{console.error("Error al capturar canvas:",err),pdf.save("".concat(titleReport,".pdf"))})):(console.warn("No se encontró el <canvas> dentro de #chart-cont"),void pdf.save("".concat(titleReport,".pdf")))}return{init:function(uniqueId,regions,type){uniqid=uniqueId,window.console.log("[ReportesUO] Inicializando con:",{uniqid:uniqid,regions:regions,type:type}),function(uniqid){window.console.log("[ReportesUO] Configurando eventos (sin jQuery)");const exportPdfBtn=document.getElementById("exportpdf"),exportExcelBtn=document.getElementById("exportexcel"),returnBtn=document.getElementById("return");exportPdfBtn&&exportPdfBtn.addEventListener("click",(()=>{var _document$getElementB;window.console.log("Exportar a PDF");exportPdf((null===(_document$getElementB=document.getElementById("tittable"))||void 0===_document$getElementB?void 0:_document$getElementB.textContent.trim())||"Reporte")}));exportExcelBtn&&exportExcelBtn.addEventListener("click",(()=>{var _document$getElementB2;window.console.log("Exportar a Excel");exportExcel("tdata",(null===(_document$getElementB2=document.getElementById("tittable"))||void 0===_document$getElementB2?void 0:_document$getElementB2.textContent.trim())||"Reporte")}));returnBtn&&returnBtn.addEventListener("click",(()=>{if(window.console.log("Regresar en historial"),customHistory.length>1){customHistory.pop();const lastRequest=customHistory.pop();loadGraphics(lastRequest.regions,lastRequest.type)}else returnBtn.style.display="none"}));document.querySelectorAll('a[data-toggle="tab"]').forEach((tabEl=>{window.console.log("Pestaña encontrada:",tabEl.id),tabEl.addEventListener("click",(e=>{const tabId=e.target.id;switch(window.console.log("Pestaña activada:",tabId),tabId){case"cert-tab":tab="certificaciones",loadGraphics(uniqid,"","regions-"+tab);break;case"user-tab":tab="users";const tbody=document.getElementById("tbody"),chartCont=document.getElementById("chart-cont");tbody&&(tbody.innerHTML=""),chartCont&&(chartCont.innerHTML=""),loadGraphics(uniqid,"","usuarios-certificaciones");break;case"home-tab":tab="avance",loadGraphics(uniqid,"","regions-"+tab);break;default:window.console.log("Pestaña no manejada:",tabId)}}))}));const tdata=document.getElementById("tdata");tdata&&tdata.addEventListener("tablaLlena",(()=>{window.console.log("Evento tablaLlena recibido"),function(){const overlay=document.getElementById("overlay");overlay&&(overlay.style.display="none")}();const tabContent=document.getElementById("myTabContent");if(tabContent){if("users"===tab){var _document$getElementB3;exportExcel("tdata",(null===(_document$getElementB3=document.getElementById("tittable"))||void 0===_document$getElementB3?void 0:_document$getElementB3.textContent.trim())||"Reporte"),tabContent.style.display="none"}else tabContent.style.display="block";document.querySelectorAll(".link-uo").forEach((link=>{link.addEventListener("click",(function(){const item=this.dataset.item,type="regions-cert"===this.dataset.type?"uos2-"+tab:"uos-"+tab,returnBtn=document.getElementById("return");returnBtn&&(returnBtn.style.display="inline-block"),loadGraphics(item,type)}))}))}}))}(uniqid),loadGraphics(uniqid,regions,type)}}}));

//# sourceMappingURL=reportes_uo_main.min.js.map