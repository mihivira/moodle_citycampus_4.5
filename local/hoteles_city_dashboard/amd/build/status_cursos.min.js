define("local_hoteles_city_dashboard/status_cursos",["jquery","core/chartjs","core/ajax","core/templates","core/notification","local_hoteles_city_dashboard/graphics_courses"],(function($,Chart,Ajax,Templates,Notification,GraphicsDashboard){var pageCurrent=1,items=0,informacion="",comparativeChart=null;function hideLoader(){$("#exampleModal").modal("hide")}function obtenerGraficas(){var peticion=$("#local_hoteles_city_dashboard_filters").serializeArray();peticion.push({name:"request_type",value:"course_list"}),$.ajax({type:"POST",url:M.cfg.wwwroot+"/local/hoteles_city_dashboard/services.php",data:peticion,dataType:"json"}).done((function(data){if(informacion=data.data,console.log("Data received:",data),function(){comparativeChart&&(comparativeChart.destroy(),comparativeChart=null);document.getElementById("curso_graficas").innerHTML="",document.getElementById("uo").innerHTML="",document.getElementById("puesto").innerHTML="",document.getElementById("marca").innerHTML="",document.getElementById("region").innerHTML=""}(),$("#div_comparativa").html('<canvas id="grafica_comparativa" width="400" height="200"></canvas>'),function(informacion){if(0===informacion.length)return;for(var data_labels=[],arr_completado_percantage=[],arr_nocompletado_percentage=[],i=0;i<informacion.length;i++){var info=informacion[i];data_labels.push(info.title||"Curso "+(i+1)),arr_completado_percantage.push(Math.max(0,info.percentage||0));var approved_users=Math.max(0,info.percentage||0),percentage_not_approved=Math.max(0,100-approved_users).toFixed(2);arr_nocompletado_percentage.push(parseFloat(percentage_not_approved))}var d_graph={labels:data_labels,datasets:[{label:"Completado",backgroundColor:"#1cc88a",stack:"Stack 0",data:arr_completado_percantage},{label:"No Completado",backgroundColor:"#e74a3b",stack:"Stack 0",data:arr_nocompletado_percentage}]},ctx=document.getElementById("grafica_comparativa");ctx?(comparativeChart&&comparativeChart.destroy(),ctx.height=Math.max(100,30*informacion.length),comparativeChart=new Chart(ctx,{type:"bar",data:d_graph,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,max:100,beginAtZero:!0},y:{stacked:!0,beginAtZero:!0}}}}),console.log("Comparative chart created successfully")):console.error("Comparative chart canvas not found")}(informacion),void 0!==informacion[0]&&informacion[0].query){var filtros=informacion[0].query,prueba=JSON.parse(filtros),custom="";for(const prop in prueba)if("institution"===prop)if("object"==typeof prueba.institution){var f_uo=prueba.institution;$("#uo").html(JSON.stringify(f_uo))}else $("#uo").html("");else"department"===prop?$("#puesto").html(prueba[prop]):(custom+=prueba[prop]+"<br><br>",$("#marca").html(custom))}var n;n=informacion.length,items=n%10>0&&n%10<5?Math.round(n/10)+1:Math.round(n/10);for(var itemsPage='<ul class="pagination"><li class="page-item"><a class="page-link" href="#pag-content" aria-label="Previous" onclick="pagePrev(); return false;"><span aria-hidden="true">&laquo;</span><span class="sr-only">Previous</span></a></li>',i=0;i<items;i++)itemsPage=agregaItemPag(itemsPage,i+1);itemsPage+='<li class="page-item"><a class="page-link" href="#pag-content" aria-label="Next" onclick="pageNext(); return false;"><span aria-hidden="true">&raquo;</span><span class="sr-only">Next</span></a></li></ul>',$("#paginacion").html(itemsPage),getInformationToPage(),hideLoader()})).fail((function(error,error2){console.log("Entra a fail"),console.log(error),console.log(error2),hideLoader()}))}function getInformationToPage(){var min=getMinIndex(pageCurrent),max=getMaxIndex(pageCurrent);document.getElementById("curso_graficas").innerHTML="",$(".page-item").removeClass("active"),$("#page"+pageCurrent).addClass("active");for(var i=0;i<informacion.length;i++)if(i>=min&&i<max){var info=informacion[i],course=new GraphicsDashboard("curso_graficas",info.title,info.chart,info,4,info.id);info.enrolled_users>0?(course.printCardCourseInfo(),setTimeout(function(course_instance,course_info){return function(){renderCourseChart(course_instance,course_info)}}(course,info),100)):course.printCardSinInfo(),setTimeout(function(info_copy){return function(){if($("#aprobados"+info_copy.id).length){$("#aprobados"+info_copy.id).html(info_copy.percentage+"%");var na=100-info_copy.percentage,not_approved_users=na.toFixed(2),dec=not_approved_users.split(".");"00"===dec[1]||"0"===dec[1]||0===dec[1]?$("#no_aprobados"+info_copy.id).html(na+"%"):$("#no_aprobados"+info_copy.id).html(not_approved_users+"%"),$("#inscritos"+info_copy.id).html(info_copy.enrolled_users)}}}(info),150)}}function renderCourseChart(course,info){console.log("Rendering chart for:",info.id,"Type:",info.chart),"bar-agrupadas"===info.chart||"horizontalBar"===info.chart||"line"===info.chart||"burbuja"===info.chart?course.comparative_graph():"pie"===info.chart||"bar"===info.chart?course.individual_graph():course.comparative_graph()}function agregaItemPag(elem,i){return elem+'<li class="page-item" id="page'+i+'"><a class="page-link" href="#pag-content" onclick="goToPage('+i+'); return false;">'+i+"</a></li>"}function getMinIndex(n){return n-1==0?0:n-1>0?10*(n-1):0}function getMaxIndex(n){return 10*n}return window.pageNext=function(){pageCurrent<items&&(pageCurrent++,getInformationToPage())},window.pagePrev=function(){pageCurrent>1&&(pageCurrent--,getInformationToPage())},window.goToPage=function(page){pageCurrent=parseInt(page),getInformationToPage()},window.getMinIndex=getMinIndex,window.getMaxIndex=getMaxIndex,{init:function(){$(document).ready((function(){$(".multiselect-setting").each((function(index,element){new Choices("#"+element.id,{removeItemButton:!0,searchEnabled:!0,placeholderValue:"Presione aqu√≠ para agregar un filtro",searchPlaceholderValue:"Buscar filtro",placeholder:!0})})),obtenerGraficas(),$("#apply-filters-btn").on("click",(function(e){e.preventDefault(),obtenerGraficas(),$("#exampleModal").modal("show")}))}))}}}));

//# sourceMappingURL=status_cursos.min.js.map