define("local_hoteles_city_dashboard/user_form_handler",["jquery","core/ajax"],(function($,ajax){return{init:function(){this.setupUsernameGenerator(),this.setupMarcaUoHandler()},setupUsernameGenerator:function(){$(".ocultar-elemento").hide();var firstname_=$("#id_firstname"),lastname_=$("#id_lastname");$("#id_firstname, #id_lastname").on("input",function(){var default_username=this.stringToSlug(firstname_.val()).substr(0,1)+this.formatMiddlename(lastname_.val())+this.getFormattedDate(),default_email=default_username+"@norte19.com";$("#id_username").val(default_username),$("#id_newpassword").val(default_username),$("#id_email").val(default_email)}.bind(this))},formatMiddlename:function(email){if(!email)return email;for(var pieces=(email=this.stringToSlug(email)).split("_"),response="",middlenameCompleted=!1,i=0;i<pieces.length;i++){var current_word=pieces[i];middlenameCompleted||(middlenameCompleted=current_word.length>2&&"del"!==current_word,response+=current_word)}return response},getFormattedDate:function(){var today=new Date,year=today.getFullYear().toString().substr(2),month=today.getMonth()+1,day=today.getDate();return month<10&&(month="0"+month),day<10&&(day="0"+day),year+month+day},stringToSlug:function(str){str=str.replace(/^\s+|\s+$/g,"").toLowerCase();for(var from="àáäâèéëêìíïîòóöôùúüûñç·/-,:;",i=0,l=from.length;i<l;i++)str=str.replace(new RegExp(from.charAt(i),"g"),"aaaaeeeeiiiioooouuuunc______".charAt(i));return str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"_").replace(/-+/g,"_")},setupMarcaUoHandler:function(){var self=this,marcas=[];$("#id_profile_field_marca").on("click",(function(){alert("Si modificas este campo, se verá afectada la relación de unidad operativa y marca")})),$.ajax({type:"POST",url:"services.php",data:[{name:"request_type",value:"get_all_marcas_uo"}],dataType:"json"}).done((function(data){"ok"===data.status&&(marcas=data.data,self.loadMarcaInstitution(marcas))})),$("select").on("change",(function(){var puestomarca=$("#id_department").val()+" - "+$("#id_profile_field_marca").val();$("#id_profile_field_Puestomarca").val(puestomarca)})),$("#id_institution").on("change",(function(){$("#id_profile_field_marca option:selected").prop("selected",!1);var hotel=$(this).val();self.changeMarca(hotel,marcas),self.reloadInstitutions(hotel)}))},loadMarcaInstitution:function(marcas){var hotel=$("#id_institution").val();this.changeMarca(hotel,marcas),this.reloadInstitutions(hotel)},changeMarca:function(hotel,marcas){$("#id_profile_field_marca option").prop("selected",!1),marcas.forEach((function(marca){if(-1!==marca.value.indexOf(hotel)){$("#id_profile_field_marca option[value='"+marca.name+"']").prop("selected",!0);var puestomarca=$("#id_department").val()+" - "+$("#id_profile_field_marca").val();$("#id_profile_field_Puestomarca").val(puestomarca)}}))},reloadInstitutions:function(institution){ajax.call([{methodname:"local_hoteles_city_dashboard_get_institutions_ggc",args:{data:{institution:institution}}}])[0].done((function(response){var data=JSON.parse(response),select=document.getElementById("id_department"),puestoUser=select.value;for(var key in select.innerHTML="",data)if(data.hasOwnProperty(key)){var optionElement=document.createElement("option");optionElement.value=key,optionElement.textContent=data[key],select.appendChild(optionElement)}select.value=puestoUser}))}}}));

//# sourceMappingURL=user_form_handler.min.js.map