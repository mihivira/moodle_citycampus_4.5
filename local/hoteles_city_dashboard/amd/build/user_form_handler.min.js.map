{"version":3,"file":"user_form_handler.min.js","sources":["../src/user_form_handler.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, ajax) {\n\n    var UserFormHandler = {\n\n        init: function() {\n            this.setupUsernameGenerator();\n            this.setupMarcaUoHandler();\n        },\n\n        setupUsernameGenerator: function() {\n            $('.ocultar-elemento').hide();\n\n            var firstname_ = $('#id_firstname');\n            var lastname_ = $('#id_lastname');\n            var domain = '@norte19.com'; // Default value\n\n           \n\n\n            $('#id_firstname, #id_lastname').on('input', function() {\n                var firstname = this.stringToSlug(firstname_.val());\n                var initial_firstname = firstname.substr(0, 1);\n                var middlename = this.formatMiddlename(lastname_.val());\n                var autogenerated = initial_firstname + middlename;\n                var default_username = autogenerated + this.getFormattedDate();\n                var default_email = default_username + domain;\n\n                $('#id_username').val(default_username);\n                $('#id_newpassword').val(default_username);\n                $('#id_email').val(default_email);\n            }.bind(this));\n        },\n\n        formatMiddlename: function(email) {\n            if (!email) return email;\n            email = this.stringToSlug(email);\n            var pieces = email.split('_');\n            var response = \"\";\n            var middlenameCompleted = false;\n\n            for (var i = 0; i < pieces.length; i++) {\n                var current_word = pieces[i];\n                if (!middlenameCompleted) {\n                    middlenameCompleted = current_word.length > 2 && current_word !== 'del';\n                    response += current_word;\n                }\n            }\n            return response;\n        },\n\n        getFormattedDate: function() {\n            var today = new Date();\n            var year = today.getFullYear().toString().substr(2);\n            var month = today.getMonth() + 1;\n            var day = today.getDate();\n\n            if (month < 10) month = '0' + month;\n            if (day < 10) day = '0' + day;\n\n            return year + month + day;\n        },\n\n        stringToSlug: function(str) {\n            str = str.replace(/^\\s+|\\s+$/g, '').toLowerCase();\n            var from = \"àáäâèéëêìíïîòóöôùúüûñç·/-,:;\";\n            var to = \"aaaaeeeeiiiioooouuuunc______\";\n            for (var i = 0, l = from.length; i < l; i++) {\n                str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));\n            }\n            return str.replace(/[^a-z0-9 -]/g, '')\n                      .replace(/\\s+/g, '_')\n                      .replace(/-+/g, '_');\n        },\n\n        setupMarcaUoHandler: function() {\n            var self = this;\n            var informacion_marca_uo = [{ name: 'request_type', value: 'get_all_marcas_uo' }];\n            var marcas = [];\n\n            $(\"#id_profile_field_marca\").on('click', function() {\n                alert(\"Si modificas este campo, se verá afectada la relación de unidad operativa y marca\");\n            });\n\n            $.ajax({\n                type: \"POST\",\n                url: \"services.php\",\n                data: informacion_marca_uo,\n                dataType: \"json\"\n            }).done(function(data) {\n                if (data.status === 'ok') {\n                    marcas = data.data;\n                    self.loadMarcaInstitution(marcas);\n                }\n            });\n\n            $(\"select\").on('change', function() {\n                var puestomarca = $(\"#id_department\").val() + \" - \" + $(\"#id_profile_field_marca\").val();\n                $(\"#id_profile_field_Puestomarca\").val(puestomarca);\n            });\n\n            $(\"#id_institution\").on('change', function() {\n                $('#id_profile_field_marca option:selected').prop('selected', false);\n                var hotel = $(this).val();\n                self.changeMarca(hotel, marcas);\n                self.reloadInstitutions(hotel);\n            });\n        },\n\n        loadMarcaInstitution: function(marcas) {\n            var hotel = $(\"#id_institution\").val();\n            this.changeMarca(hotel, marcas);\n            this.reloadInstitutions(hotel);\n        },\n\n        changeMarca: function(hotel, marcas) {\n            $(\"#id_profile_field_marca option\").prop('selected', false);\n            marcas.forEach(function(marca) {\n                if (marca.value.indexOf(hotel) !== -1) {\n                    $(\"#id_profile_field_marca option[value='\" + marca.name + \"']\").prop('selected', true);\n                    var puestomarca = $(\"#id_department\").val() + \" - \" + $(\"#id_profile_field_marca\").val();\n                    $(\"#id_profile_field_Puestomarca\").val(puestomarca);\n                }\n            });\n        },\n\n        reloadInstitutions: function(institution) {\n            ajax.call([{\n                methodname: 'local_hoteles_city_dashboard_get_institutions_ggc',\n                args: {\n                    data: { institution: institution }\n                }\n            }])[0].done(function(response) {\n                var data = JSON.parse(response);\n                var select = document.getElementById(\"id_department\");\n                var puestoUser = select.value;\n                select.innerHTML = '';\n\n                for (var key in data) {\n                    if (data.hasOwnProperty(key)) {\n                        var optionElement = document.createElement(\"option\");\n                        optionElement.value = key;\n                        optionElement.textContent = data[key];\n                        select.appendChild(optionElement);\n                    }\n                }\n\n                select.value = puestoUser;\n            });\n        }\n    };\n\n    return UserFormHandler;\n});"],"names":["define","$","ajax","init","setupUsernameGenerator","setupMarcaUoHandler","hide","firstname_","lastname_","on","default_username","this","stringToSlug","val","substr","formatMiddlename","getFormattedDate","default_email","bind","email","pieces","split","response","middlenameCompleted","i","length","current_word","today","Date","year","getFullYear","toString","month","getMonth","day","getDate","str","replace","toLowerCase","from","l","RegExp","charAt","self","marcas","alert","type","url","data","name","value","dataType","done","status","loadMarcaInstitution","puestomarca","prop","hotel","changeMarca","reloadInstitutions","forEach","marca","indexOf","institution","call","methodname","args","JSON","parse","select","document","getElementById","puestoUser","key","innerHTML","hasOwnProperty","optionElement","createElement","textContent","appendChild"],"mappings":"AAAAA,wDAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,YAElB,CAElBC,KAAM,gBACGC,8BACAC,uBAGTD,uBAAwB,WACpBH,EAAE,qBAAqBK,WAEnBC,WAAaN,EAAE,iBACfO,UAAYP,EAAE,gBAMlBA,EAAE,+BAA+BQ,GAAG,QAAS,eAKrCC,iBAJYC,KAAKC,aAAaL,WAAWM,OACXC,OAAO,EAAG,GAC3BH,KAAKI,iBAAiBP,UAAUK,OAEVF,KAAKK,mBACxCC,cAAgBP,iBAXX,eAaTT,EAAE,gBAAgBY,IAAIH,kBACtBT,EAAE,mBAAmBY,IAAIH,kBACzBT,EAAE,aAAaY,IAAII,gBACrBC,KAAKP,QAGXI,iBAAkB,SAASI,WAClBA,MAAO,OAAOA,cAEfC,QADJD,MAAQR,KAAKC,aAAaO,QACPE,MAAM,KACrBC,SAAW,GACXC,qBAAsB,EAEjBC,EAAI,EAAGA,EAAIJ,OAAOK,OAAQD,IAAK,KAChCE,aAAeN,OAAOI,GACrBD,sBACDA,oBAAsBG,aAAaD,OAAS,GAAsB,QAAjBC,aACjDJ,UAAYI,qBAGbJ,UAGXN,iBAAkB,eACVW,MAAQ,IAAIC,KACZC,KAAOF,MAAMG,cAAcC,WAAWjB,OAAO,GAC7CkB,MAAQL,MAAMM,WAAa,EAC3BC,IAAMP,MAAMQ,iBAEZH,MAAQ,KAAIA,MAAQ,IAAMA,OAC1BE,IAAM,KAAIA,IAAM,IAAMA,KAEnBL,KAAOG,MAAQE,KAG1BtB,aAAc,SAASwB,KACnBA,IAAMA,IAAIC,QAAQ,aAAc,IAAIC,sBAChCC,KAAO,+BAEFf,EAAI,EAAGgB,EAAID,KAAKd,OAAQD,EAAIgB,EAAGhB,IACpCY,IAAMA,IAAIC,QAAQ,IAAII,OAAOF,KAAKG,OAAOlB,GAAI,KAFxC,+BAEiDkB,OAAOlB,WAE1DY,IAAIC,QAAQ,eAAgB,IACxBA,QAAQ,OAAQ,KAChBA,QAAQ,MAAO,MAG9BhC,oBAAqB,eACbsC,KAAOhC,KAEPiC,OAAS,GAEb3C,EAAE,2BAA2BQ,GAAG,SAAS,WACrCoC,MAAM,wFAGV5C,EAAEC,KAAK,CACH4C,KAAM,OACNC,IAAK,eACLC,KAVuB,CAAC,CAAEC,KAAM,eAAgBC,MAAO,sBAWvDC,SAAU,SACXC,MAAK,SAASJ,MACO,OAAhBA,KAAKK,SACLT,OAASI,KAAKA,KACdL,KAAKW,qBAAqBV,YAIlC3C,EAAE,UAAUQ,GAAG,UAAU,eACjB8C,YAActD,EAAE,kBAAkBY,MAAQ,MAAQZ,EAAE,2BAA2BY,MACnFZ,EAAE,iCAAiCY,IAAI0C,gBAG3CtD,EAAE,mBAAmBQ,GAAG,UAAU,WAC9BR,EAAE,2CAA2CuD,KAAK,YAAY,OAC1DC,MAAQxD,EAAEU,MAAME,MACpB8B,KAAKe,YAAYD,MAAOb,QACxBD,KAAKgB,mBAAmBF,WAIhCH,qBAAsB,SAASV,YACvBa,MAAQxD,EAAE,mBAAmBY,WAC5B6C,YAAYD,MAAOb,aACnBe,mBAAmBF,QAG5BC,YAAa,SAASD,MAAOb,QACzB3C,EAAE,kCAAkCuD,KAAK,YAAY,GACrDZ,OAAOgB,SAAQ,SAASC,WACgB,IAAhCA,MAAMX,MAAMY,QAAQL,OAAe,CACnCxD,EAAE,yCAA2C4D,MAAMZ,KAAO,MAAMO,KAAK,YAAY,OAC7ED,YAActD,EAAE,kBAAkBY,MAAQ,MAAQZ,EAAE,2BAA2BY,MACnFZ,EAAE,iCAAiCY,IAAI0C,kBAKnDI,mBAAoB,SAASI,aACzB7D,KAAK8D,KAAK,CAAC,CACPC,WAAY,oDACZC,KAAM,CACFlB,KAAM,CAAEe,YAAaA,iBAEzB,GAAGX,MAAK,SAAS9B,cACb0B,KAAOmB,KAAKC,MAAM9C,UAClB+C,OAASC,SAASC,eAAe,iBACjCC,WAAaH,OAAOnB,UAGnB,IAAIuB,OAFTJ,OAAOK,UAAY,GAEH1B,QACRA,KAAK2B,eAAeF,KAAM,KACtBG,cAAgBN,SAASO,cAAc,UAC3CD,cAAc1B,MAAQuB,IACtBG,cAAcE,YAAc9B,KAAKyB,KACjCJ,OAAOU,YAAYH,eAI3BP,OAAOnB,MAAQsB"}