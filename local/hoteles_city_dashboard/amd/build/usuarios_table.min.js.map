{"version":3,"file":"usuarios_table.min.js","sources":["../src/usuarios_table.js"],"sourcesContent":["define(['core/modal_factory','core/modal_events', 'core/modal_save_cancel'], function(ModalFactory, ModalEvents, ModalSaveCancel) {\n\n    return {\n        init: function(cont, requestType, printedRows, linkFields, containerId) {\n\n            console.log('Initializing usuarios_table.js with parameters:', cont, requestType, printedRows, linkFields, containerId);\n\n            linkFields = linkFields.split(',');\n            printedRows = printedRows.split(',');\n            console.log('linkFields:', linkFields);\n            console.log('printedRows:', printedRows);\n            const container = document.getElementById(containerId);\n            if (!container) {\n                console.error('Config container not found:', containerId);\n                return;\n            }\n\n            \n            let columns;\n            try {\n                columns = JSON.parse(container.dataset.columns);\n            } catch (e) {\n                console.error('Failed to parse columns JSON:', e);\n                return;\n            }\n            console.log('columns2', columns);\n\n            //recorrer columns\n            columns.forEach((column, index) => {\n                if (column.data === 'link_edit_user') {\n                    column.render = function(data, type, row) {\n                        return `<a target=\"_self\" class=\"btn btn-primary\" href=\"administrar_usuarios.php?id=${data}\">Editar usuario</a>`;\n                    };\n                } else if (column.data === 'name') {\n                    column.render = function(data, type, row) {\n                        const parts = data.split('||'); // nombre||id\n                        return `<a class=\"_blank\" href=\"administrar_usuarios.php?id=${parts[1]}\">${parts[0]}</a>`;\n                    };\n                } else if (column.data === 'link_suspend_user') {\n                    column.render = function(data, type, row) {\n                        const arrSusp = data.split('||'); // estado||id\n                        const clase = arrSusp[1] === '1' ? 'btn btn-danger' : 'btn btn-success';\n                        const texto = arrSusp[1] === '1' ?  'Activar' : 'Suspender';\n                        const id = arrSusp[0]; // Assuming 'id' is the second part\n                        return `<button class=\"confirm-action ${clase}\" data-id=\"${id}\" data-texto=\"${texto}\">${texto}</button>`;\n                    };\n                }\n            });\n\n          \n            const table = $('#empTable').DataTable({\n                processing: true,\n                serverSide: true,\n                serverMethod: 'post',\n                ajax: {\n                    url: 'services.php',\n                    data: function(d) {\n                        d.request_type = requestType;\n                    }\n                },\n                lengthMenu: [[10, 15, 20, 100, -1], [10, 15, 20, 100, \"Todos los registros\"]],\n                dom: 'Bfrtip',\n                pageLength: 10,\n                buttons: [\n                    {\n                        extend: 'excelHtml5',\n                        text: '<i class=\"fa fa-file-excel-o\"></i> Exportar a Excel',\n                        exportOptions: {\n                            modifier: { search: 'applied', order: 'applied' },\n                            columns: printedRows\n                        },\n                        className: 'btn btn-outline-secondary'\n                    },\n                    {\n                        extend: 'csvHtml5',\n                        text: '<i class=\"fa fa-file-o\"></i> Exportar a CSV',\n                        exportOptions: {\n                            modifier: { search: 'applied', order: 'applied' },\n                            columns: printedRows\n                        },\n                        className: 'btn btn-outline-secondary'\n                    },\n                    {\n                        extend: 'pageLength',\n                        className: 'btn btn-outline-secondary'\n                    }\n                ],\n                columns: columns,\n                columnDefs: [\n                    { targets: linkFields, orderable: false }\n                ],\n                language: {\n                    url: \"datatables/Spanish.json\",\n                    emptyTable: \"No se encontró información\",\n                    loadingRecords: \"Cargando...\",\n                    processing: \"Procesando...\",\n                    search: \"Búsqueda:\",\n                    paginate: {\n                        first: \"Primera\",\n                        last: \"Última\",\n                        next: \"Siguiente\",\n                        previous: \"Anterior\"\n                    },\n                    buttons: {\n                        pageLength: {\n                            _: \"Mostrando %d filas\",\n                            '-1': \"Mostrando todas las filas\"\n                        }\n                    }\n                },\n                drawCallback: function() {\n                    $('.confirm-action').off('click').on('click', function(e) {\n                        e.preventDefault();\n\n                        modSusp($(this).data('id'), $(this).data('texto'));\n                    });\n                },\n                initComplete: function() {\n                    // Aquí puedes agregar cualquier código que necesites ejecutar una vez que la tabla esté completamente inicializada.\n                    console.log('DataTable initialized successfully.');\n                }\n            });\n\n            // Function to handle suspension or activation of users\n            modSusp = async function(id, texto) {\n                 const modal = await ModalSaveCancel.create({\n                    title: 'Confirmar acción',\n                    body: `¿Estás seguro de que deseas ${texto} este usuario?`,\n                });\n\n                modal.getRoot().on(ModalEvents.save, (e) => {\n                    e.preventDefault();\n                    // Aquí puedes agregar la lógica para suspender o activar al usuario.\n                    console.log(`User ${id} has been ${texto.toLowerCase()}.`);\n                    // ir \n                    window.location.href = `administrar_usuarios.php?suspenduser=1&id=${id}`;\n                    \n                })\n\n                modal.getRoot().on(ModalEvents.cancel, (e) => {\n                    e.preventDefault();\n                    modal.hide();\n                });\n                modal.show();\n                \n            }\n            \n        },\n\n    };\n});\n\n\n    \n"],"names":["define","ModalFactory","ModalEvents","ModalSaveCancel","init","cont","requestType","printedRows","linkFields","containerId","console","log","split","container","document","getElementById","error","columns","JSON","parse","dataset","e","forEach","column","index","data","render","type","row","parts","arrSusp","clase","texto","id","$","DataTable","processing","serverSide","serverMethod","ajax","url","d","request_type","lengthMenu","dom","pageLength","buttons","extend","text","exportOptions","modifier","search","order","className","columnDefs","targets","orderable","language","emptyTable","loadingRecords","paginate","first","last","next","previous","_","drawCallback","off","on","preventDefault","modSusp","this","initComplete","async","modal","create","title","body","getRoot","save","toLowerCase","window","location","href","cancel","hide","show"],"mappings":"AAAAA,qDAAO,CAAC,qBAAqB,oBAAqB,2BAA2B,SAASC,aAAcC,YAAaC,uBAEtG,CACHC,KAAM,SAASC,KAAMC,YAAaC,YAAaC,WAAYC,aAEvDC,QAAQC,IAAI,kDAAmDN,KAAMC,YAAaC,YAAaC,WAAYC,aAE3GD,WAAaA,WAAWI,MAAM,KAC9BL,YAAcA,YAAYK,MAAM,KAChCF,QAAQC,IAAI,cAAeH,YAC3BE,QAAQC,IAAI,eAAgBJ,mBACtBM,UAAYC,SAASC,eAAeN,iBACrCI,sBACDH,QAAQM,MAAM,8BAA+BP,iBAK7CQ,YAEAA,QAAUC,KAAKC,MAAMN,UAAUO,QAAQH,SACzC,MAAOI,eACLX,QAAQM,MAAM,gCAAiCK,GAGnDX,QAAQC,IAAI,WAAYM,SAGxBA,QAAQK,SAAQ,CAACC,OAAQC,SACD,mBAAhBD,OAAOE,KACPF,OAAOG,OAAS,SAASD,KAAME,KAAMC,iGACqDH,8BAEnE,SAAhBF,OAAOE,KACdF,OAAOG,OAAS,SAASD,KAAME,KAAMC,WAC3BC,MAAQJ,KAAKb,MAAM,0EACqCiB,MAAM,gBAAOA,MAAM,YAE9D,sBAAhBN,OAAOE,OACdF,OAAOG,OAAS,SAASD,KAAME,KAAMC,WAC3BE,QAAUL,KAAKb,MAAM,MACrBmB,MAAuB,MAAfD,QAAQ,GAAa,iBAAmB,kBAChDE,MAAuB,MAAfF,QAAQ,GAAc,UAAY,YAC1CG,GAAKH,QAAQ,iDACqBC,4BAAmBE,4BAAmBD,mBAAUA,wBAMtFE,EAAE,aAAaC,UAAU,CACnCC,YAAY,EACZC,YAAY,EACZC,aAAc,OACdC,KAAM,CACFC,IAAK,eACLf,KAAM,SAASgB,GACXA,EAAEC,aAAepC,cAGzBqC,WAAY,CAAC,CAAC,GAAI,GAAI,GAAI,KAAM,GAAI,CAAC,GAAI,GAAI,GAAI,IAAK,wBACtDC,IAAK,SACLC,WAAY,GACZC,QAAS,CACL,CACIC,OAAQ,aACRC,KAAM,sDACNC,cAAe,CACXC,SAAU,CAAEC,OAAQ,UAAWC,MAAO,WACtCnC,QAASV,aAEb8C,UAAW,6BAEf,CACIN,OAAQ,WACRC,KAAM,8CACNC,cAAe,CACXC,SAAU,CAAEC,OAAQ,UAAWC,MAAO,WACtCnC,QAASV,aAEb8C,UAAW,6BAEf,CACIN,OAAQ,aACRM,UAAW,8BAGnBpC,QAASA,QACTqC,WAAY,CACR,CAAEC,QAAS/C,WAAYgD,WAAW,IAEtCC,SAAU,CACNjB,IAAK,0BACLkB,WAAY,6BACZC,eAAgB,cAChBvB,WAAY,gBACZe,OAAQ,YACRS,SAAU,CACNC,MAAO,UACPC,KAAM,SACNC,KAAM,YACNC,SAAU,YAEdlB,QAAS,CACLD,WAAY,CACRoB,EAAG,0BACG,+BAIlBC,aAAc,WACVhC,EAAE,mBAAmBiC,IAAI,SAASC,GAAG,SAAS,SAAS/C,GACnDA,EAAEgD,iBAEFC,QAAQpC,EAAEqC,MAAM9C,KAAK,MAAOS,EAAEqC,MAAM9C,KAAK,cAGjD+C,aAAc,WAEV9D,QAAQC,IAAI,0CAKpB2D,QAAUG,eAAexC,GAAID,aAClB0C,YAAcvE,gBAAgBwE,OAAO,CACxCC,MAAO,mBACPC,2CAAqC7C,0BAGzC0C,MAAMI,UAAUV,GAAGlE,YAAY6E,MAAO1D,IAClCA,EAAEgD,iBAEF3D,QAAQC,mBAAYsB,wBAAeD,MAAMgD,oBAEzCC,OAAOC,SAASC,yDAAoDlD,OAIxEyC,MAAMI,UAAUV,GAAGlE,YAAYkF,QAAS/D,IACpCA,EAAEgD,iBACFK,MAAMW,UAEVX,MAAMY"}