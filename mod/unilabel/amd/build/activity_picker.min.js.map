{"version":3,"file":"activity_picker.min.js","sources":["../src/activity_picker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * unilabel helper for activity picker\n *\n * @author      Andreas Grabs <info@grabs-edv.de>\n * @copyright   2018 onwards Grabs EDV {@link https://www.grabs-edv.de}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport log from 'core/log';\n\nexport const init = async(formid) => {\n    let currentinput;\n    let currenturltitleinput;\n    let maybeactivityelement;\n    let modalid = 'unilabel-modal-activity-picker-' + formid;\n    const str = await import('core/str');\n    const deletestr = await str.get_string('delete');\n    const inputswitcher = await import('mod_unilabel/activity_picker_input_switcher');\n\n    $('#' + modalid).on('show.bs.modal', function() {\n        $('#' + modalid).appendTo('body');\n        currentinput = document.querySelector('#' + document.querySelector('#' + modalid).dataset.inputid);\n\n        if (document.querySelector('#' + modalid).dataset.labelid == '') {\n            currenturltitleinput = null; // Url title field does not exist.\n        } else {\n            currenturltitleinput = document.querySelector('#' + document.querySelector('#' + modalid).dataset.labelid);\n        }\n        maybeactivityelement = currentinput.parentElement.querySelector('div.activitytitle.unilabel-input-replacement');\n    });\n\n    document.querySelector('#unilabel-activity-picker').addEventListener('click', (e) => {\n        if (!e.target.classList.contains('activity-picker-link')) {\n            return;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (maybeactivityelement) {\n            log.debug('There already is an replacement element. It must be remove before a new one is added.');\n            maybeactivityelement.remove();\n        }\n\n        $('#unilabel-modal-activity-picker-' + formid).modal('hide');\n        if (e.target.classList.contains('activity-picker-link')) {\n            let url = e.target.href;\n            let activitylinksrc = e.target.closest('.activitytitle');\n            inputswitcher.switchInput(currentinput, currenturltitleinput, activitylinksrc, url, true, deletestr);\n        }\n    });\n\n    $(\"#search-\" + formid).on(\"keyup\", function() {\n        let value = $(this).val().toLowerCase();\n        $(\"#unilabel-activity-picker-list li\").filter((index, element) => {\n            // Looking for data-filterstring we can apply the search term.\n            if (element.dataset.filterstring.toLowerCase().indexOf(value) > -1) {\n                $(element).slideDown();\n            } else {\n                $(element).slideUp();\n            }\n            return index;\n        });\n    });\n};\n"],"names":["async","currentinput","currenturltitleinput","maybeactivityelement","modalid","formid","str","deletestr","get_string","inputswitcher","on","appendTo","document","querySelector","dataset","inputid","labelid","parentElement","addEventListener","e","target","classList","contains","preventDefault","stopPropagation","debug","remove","modal","url","href","activitylinksrc","closest","switchInput","value","this","val","toLowerCase","filter","index","element","filterstring","indexOf","slideDown","slideUp"],"mappings":"gfA0BoBA,MAAAA,aACZC,aACAC,qBACAC,qBACAC,QAAU,kCAAoCC,aAC5CC,olBACAC,gBAAkBD,IAAIE,WAAW,UACjCC,2tBAEJ,IAAML,SAASM,GAAG,iBAAiB,+BAC/B,IAAMN,SAASO,SAAS,QAC1BV,aAAeW,SAASC,cAAc,IAAMD,SAASC,cAAc,IAAMT,SAASU,QAAQC,SAGtFb,qBADyD,IAAzDU,SAASC,cAAc,IAAMT,SAASU,QAAQE,QACvB,KAEAJ,SAASC,cAAc,IAAMD,SAASC,cAAc,IAAMT,SAASU,QAAQE,SAEtGb,qBAAuBF,aAAagB,cAAcJ,cAAc,mDAGpED,SAASC,cAAc,6BAA6BK,iBAAiB,SAAUC,OACtEA,EAAEC,OAAOC,UAAUC,SAAS,0BAGjCH,EAAEI,iBACFJ,EAAEK,kBAEErB,oCACIsB,MAAM,yFACVtB,qBAAqBuB,8BAGvB,mCAAqCrB,QAAQsB,MAAM,QACjDR,EAAEC,OAAOC,UAAUC,SAAS,yBAAyB,KACjDM,IAAMT,EAAEC,OAAOS,KACfC,gBAAkBX,EAAEC,OAAOW,QAAQ,kBACvCtB,cAAcuB,YAAY/B,aAAcC,qBAAsB4B,gBAAiBF,KAAK,EAAMrB,mCAIhG,WAAaF,QAAQK,GAAG,SAAS,eAC3BuB,OAAQ,mBAAEC,MAAMC,MAAMC,kCACxB,qCAAqCC,QAAO,CAACC,MAAOC,WAE9CA,QAAQzB,QAAQ0B,aAAaJ,cAAcK,QAAQR,QAAU,sBAC3DM,SAASG,gCAETH,SAASI,UAERL"}